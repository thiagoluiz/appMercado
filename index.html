
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD com Local Storage</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        @media (max-width: 768px) {
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .table th, .table td {
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">CRUD de Itens com Local Storage</h2>
        
        <form id="item-form" class="row g-3">
            <div class="col-md-3">
                <label for="itemName" class="form-label">Nome do Item</label>
                <input type="text" class="form-control" id="itemName" required>
            </div>
            <div class="col-md-2">
                <label for="itemQuantity" class="form-label">Quantidade</label>
                <input type="number" class="form-control" id="itemQuantity" min="1" value="1" required>
            </div>
            <div class="col-md-2">
                <label for="itemValue" class="form-label">Valor Unitário</label>
                <input type="number" class="form-control" id="itemValue" min="0.01" step="0.01" required>
            </div>
            <div class="col-md-2">
                <label for="itemTotal" class="form-label">Total Item</label>
                <input type="number" class="form-control" id="itemTotal" readonly>
            </div>
            <div class="col-md-3 align-self-end">
                <button type="button" class="btn btn-primary w-100" id="addItem">Adicionar Item</button>
            </div>
        </form>
        
        <h4 class="mt-5">Lista de Itens</h4>
        <div class="table-responsive">
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Nome do Item</th>
                        <th>Quantidade</th>
                        <th>Valor Unitário</th>
                        <th>Total Item</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="itemTableBody"></tbody>
                <tfoot>
                    <tr>
                        <th colspan="3" class="text-end">Total Geral:</th>
                        <th id="grandTotal">0.00</th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
        </div>

        <h4 class="mt-5">Orçamento</h4>
        <div class="row g-3 align-items-center">
            <div class="col-md-4">
                <label for="availableMoney" class="form-label">Dinheiro Disponível</label>
                <input type="number" class="form-control" id="availableMoney" min="0" step="0.01" required>
            </div>
            <div class="col-md-3 align-self-end">
                <button type="button" class="btn btn-success w-100" id="updateMoney">Atualizar Orçamento</button>
            </div>
            <div class="col-md-5">
                <h5>Saldo Restante: <span id="remainingBalance">0.00</span></h5>
            </div>
        </div>
    </div>

    <script>
        let editIndex = null;
        const itemName = document.getElementById('itemName');
        const itemQuantity = document.getElementById('itemQuantity');
        const itemValue = document.getElementById('itemValue');
        const itemTotal = document.getElementById('itemTotal');
        const addItemButton = document.getElementById('addItem');
        const itemTableBody = document.getElementById('itemTableBody');
        const grandTotal = document.getElementById('grandTotal');
        const availableMoney = document.getElementById('availableMoney');
        const updateMoneyButton = document.getElementById('updateMoney');
        const remainingBalance = document.getElementById('remainingBalance');

        let items = JSON.parse(localStorage.getItem('items')) || [];
        let money = parseFloat(localStorage.getItem('money')) || 0;
        availableMoney.value = money;

        addItemButton.addEventListener('click', () => {
            if (!itemName.value || !itemQuantity.value || !itemValue.value) {
                alert('Preencha todos os campos!');
                return;
            }
            const newItem = {
                name: itemName.value,
                quantity: parseInt(itemQuantity.value),
                value: parseFloat(itemValue.value),
                total: parseFloat(itemTotal.value)
            };
            if (editIndex !== null) {
                items[editIndex] = newItem;
                editIndex = null;
                addItemButton.textContent = 'Adicionar Item';
            } else {
                items.push(newItem);
            }
            localStorage.setItem('items', JSON.stringify(items));
            renderItems();
            clearForm();
        });

        function editItem(index) {
            const item = items[index];
            itemName.value = item.name;
            itemQuantity.value = item.quantity;
            itemValue.value = item.value;
            itemTotal.value = item.total;
            editIndex = index;
            addItemButton.textContent = 'Salvar Edição';
        }

        function deleteItem(index) {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                items.splice(index, 1);
                localStorage.setItem('items', JSON.stringify(items));
                renderItems();
            }
        }

        function renderItems() {
            itemTableBody.innerHTML = '';
            items.forEach((item, index) => {
                itemTableBody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>${item.value.toFixed(2)}</td>
                        <td>${item.total.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editItem(${index})">Editar</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteItem(${index})">Excluir</button>
                        </td>
                    </tr>`;
            });
            calculateGrandTotal();
        }

        renderItems();
    </script>
</body>
</html>
